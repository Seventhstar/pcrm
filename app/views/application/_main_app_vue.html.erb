<script>
  Vue.component('v-select', VueSelect.VueSelect)

  let nav = new Vue({
    el: '.nav_select',
    data: <%= fill_vue_data(nil, {
      list_values: 'year main_city',
      lists: 'years cities'
    }, 'app') %>,

    watch: {
      year() {  
        // console.log('app', window.app)
        if (typeof(app) != "undefined" && app !== null) {
          app.onInput({name: 'year', label: this.year.label, value: this.year.value}); 
          sortable_prepare({});
        } else {
          delay('document.location.reload(true)', 400)
        }
      },

      main_city() {
        if (typeof(app) != "undefined" && app !== null) {
          app.onInput({name: 'main_city', label: this.main_city.label, value: this.main_city.value}); 
        } else { 
          delay('sortable_query({})', 700)
        }
        $.ajax({
            type: "POST",
            url: "/ajax/set_city",
            data: {city: this.main_city.value},
            dataType: "json",
            encode: true
          })
      }
    },
    
  })
</script>