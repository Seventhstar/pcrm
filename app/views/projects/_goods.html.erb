<table class="tleads twfixed" id="project_goods<%= pgt.id %>"  model="ProjectGood" action="project_goods" color_cls="ordered">
   
  <thead class="<%= @goods.count>0 ? '' : 'hidden' %>">
    <tr>
      <th width='220px'>Позиция</th>
      <th width='216px'>Поставщик</th>
      <th width='115px'>Дата</th>
      <th width='230px'>Примечание</th>

      <th width='58px'>Валюта</th>
      <th fld='gsum' width='90px'>Стоимость </th>
      <th width='48px'></th>
    </tr>
  </thead>

  <%  total = [0,0,0,0] %>
  <tbody>
    <% @goods.order(:id).each do |g| %>
      <tr id="pgt_item<%= g.id %>" class="sw_color <%= class_for_prj_goods(g) %>">
        <td width='220'><%= g.name %></td>
        <td width='216'><%= g.provider_name %></td>
        <td width='115'><%= g.date_place.try('strftime',"%d.%m.%Y") %></td>
        <td width='230'><%= g.description %></td>
 
        <td width='58px'><%= g.currency_name %></td>
        <td width='90px' class=""><%= g.gsum.to_sum if !g.gsum.nil? %></td>
        <%= tool_icons(g, {icons:'modal_edit,delete',tag:'link', add_class:'td_right', modal: true, width: '48px'}) %>
        <%  total[g.currency_id] = total[g.currency_id] + g.gsum if !g.gsum.nil? %>
        <%  @all_total[g.currency_id] = @all_total[g.currency_id] + g.gsum if !g.gsum.nil? %>
        
      </tr>
    <% end %>
      <tr id="new_pgt_item<%= pgt.id %>" class="invisible editable new_row">
        <% iname = ['project_good_',pgt.id,'_'].join %>
        <%= hidden_field iname,'goodstype_id', value: pgt.id %>
        <td class="fw" width='220px'><%= text_field iname,:name, {:class => 'txt'} %></td>
        <td width='216px'>
        <% gt_coll = Goodstype.find_by(id: pgt.id) %>
        <% if !gt_coll.nil? %>
          <%= chosen_src "provider_id", gt_coll.providers, nil,{nil_value: 'Выберите поставщика...',add_name: iname} %></td>
        <% end %>
        <td class="caption3" width='115px'><%= text_field iname,:date_place, { value: Date.today.try('strftime',"%d.%m.%Y") , :class => 'txt datepicker'} %></td>
        <td class="caption3" width='230px'><%= text_field iname,:description, {:class => 'txt fullwidth'} %></td>

        <td width='58px'><%= chosen_src "currency_id", currency_src,1,{nil_value: '',add_name: iname, add_class: 'currency_src'} %></td>
        <%= td_sum_field(iname, :gsum, '', {width: '90px'}) %>

        <td width="48px"><span class="sub btn_a" id="btn-sub-send" pe_id="<%= pgt.id %>" action='/project_goods/' prm='project_good_<%= pgt.id %>_'>Сохр.</span></td>
      </tr>
      <%= render 'project_goods/total', total: total, total_order: 0 %>
  </tbody>
</table>