<%= simple_form_for(@absence) do |f| %>
<%= f.hidden_field :reopen,{action_name: action_name} %>

<% if !is_admin? %>
  <%= f.hidden_field :user_id,  :value => @absence.user_id ||= current_user.id %>
<% end %>

  <table class="tbl_fc tbl_fc_1">
    <tr><td class="caption">Причина:</td>
    <td  colspan="3">         
      <% if is_admin? || action_name == 'new' || 
            (@absence.user_id == current_user.id && @absence.created_at > (Date.today-1.day) && @absence.new_reason_id.nil? )  %>
        <div class="inp_w"><%= f.select 'reason_id', options_for_select(@reasons.collect{ |u| [u.name, u.id] },@absence.reason_id) %></div>
      <% else %>
        <div class="lbl"><%= @absence.reason_name %></div>
      <% end %>
    </td>
    <td></td>
    </tr>
    <% disp_obj = @absence.reason_id==2 || @absence.reason_id==3 ? 'table-row;' : 'none;' %>
    <% disp_trgt = @absence.reason_id==2 ? ' ' : 'display: none;' %>
    <tr style="display: <%= disp_obj %>" class='p_obj'>
      <td class="caption p_obj">Проект:</td>
      <td colspan="3" class="p_obj">
      <div class="inp_w">
      <%= f.select :project_id, content_tag(:option,'Выберите...',:value=>0)+options_for_select(@projects.collect{ |u| [u.address, u.id] },@absence.project_id),{},{class:'schosen'} %></div></td>
      <td class="caption caption_sm"><span style="<%= disp_trgt %>" class="p_trgt"> Цель: </span></td>
      <td ><span style="<%= disp_trgt %>" class="p_trgt">
      <%= f.select :target_id, content_tag(:option,'Выберите...',:value=>0)+options_for_select(@targets.collect{ |u| [u.name, u.id] },@absence.target_id), {},{class: 'chosen'} %></span></td>
    </tr>

    <tr><td class="caption">Дата c:</td>
      <td width='200px;'><div class="inp_"><%= f.text_field :dt_from, :value => @dt_from, label: false, class: "txt datepicker" %></div></td>
      <td class="caption caption_to"><%= f.hidden_field :checked %><span class="check_img <%= @checked ? 'checked' : '' %>" id='dt_to_check'></span> по:</td>
      <td width='180px;'><div class="inp_">
        <% if @checked %>
          <%= f.text_field :dt_to, :value => @dt_to, label: false, class: "txt datepicker" %>
        <% else %>
          <%= f.text_field :dt_to, :value => @dt_to, label: false, class: "txt ", disabled: 'disabled' %>
        <% end %>
        </div></td>
      <td class="caption caption_sm">Время:</td>
      <td >
        <div class="inp_w"><%= f.text_field :t_from, :value => @t_from, label: false, class: "txt timepicker" %></div>
        <span class="time_separator">–</span>
        <div class="inp_w"><%= f.text_field :t_to, :value => @t_to, label: false, class: "txt timepicker" %></div></td>
      <td></td>
    </tr>

      <tr><td class="caption">Комментарий:</td>
        <td colspan="5"><div class="inp_w" ><%= f.text_area :comment, class: 'txt alone',label: false %></div></td></tr>
    <% if is_admin? %>
      <tr><td class="caption">Сотрудник:</td>
          <td width='490px;' colspan="3"><div class="inp_w" >
           <%= f.select :user_id, options_for_select(User.order(:name).collect{ |u| [u.name, u.id] },@absence.user_id), {},{class: 'chosen'} %></div>
      </td></tr>

    <% end %>
        
      <% if controller.action_name == 'edit'  %>
        <tr><td class="caption">Изменить причину на:</td>
          <td colspan="3"><div class="inp_w"><%= f.select 'new_reason_id', content_tag(:option,'Выберите...',:value=>0)+options_for_select(@reasons.collect{ |u| [u.name, u.id] },@absence.new_reason_id), {},{class: 'chosen'} %>
          </div></td></tr>
      <% end -%>
      <tr><td class="last_td"></td>
        <td class="last_td" colspan="3">
          <% if is_admin? || action_name == 'new' || @absence.user_id == current_user.id %>
            <%= link_to 'Отмена', absences_url, :class => "sub btn_a btn_reset"%><%= f.button :submit, value: 'Сохранить', :class => 'sub btn_a' %></td></tr>
          <% end %>
  </table>
<% end %>

<div class="sep_3"></div>

<div class='shops' id='dshops' style="display:<%= @absence.reason_id==3 ? 'block;' : 'none;'%>" >
<% if !@absence.id.nil? %>
    <%= render "shops" %>
<% end %>    
</div>

<div class="sep_3"></div>