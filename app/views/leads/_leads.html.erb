<%= render "sortmenu" %>
<%= hidden_field_tag :sort, params[:sort] %>

<% cur_month  = nil %>
<% cur_user   = nil %>
<% cur_status = nil %>
<% first_table = true %>

<% lead = @leads.first %>


<% @leads.each do |lead| %>
    <% if cur_month != lead.status_date.month && (params[:sort] == "status_date" || params[:sort] == nil)%>
          <% cur_month = lead.status_date.month %>
          
          <%= render "head", {:first_table => first_table, :heading => t(lead.status_date.strftime("%B"))+" "+lead.status_date.strftime("%Y") } %>
        
      <% elsif cur_user != lead.user.name && (params[:sort] == "user_id")%>
        <% cur_user = lead.user.name %>

          <%= render "head", {:first_table => first_table, :heading => t(lead.user.name) } %>

      <% elsif cur_status != lead.status.name && (params[:sort] == "status_id")%>
        <% cur_status = lead.status.name %>
        
        <%= render "head", {:first_table => first_table, :heading => t(lead.status.name) } %>
        

      <% end %>
        <% first_table = false %>        

        <tr class="<%= class_for_lead(lead) %>" >      
        <td><%= lead.status_name %></td>
        <td><%= lead.status_date %></td>
        <td><%= lead.fio %></td>
        <td><%= lead.phone %></td>
        <td><%= lead.info %></td>
        <td class="center"><%= lead.footage %></td>
        <td class="center"><%= lead.start_date %></td>
        <%= render "shared/td_edit_delete", :element => lead %>

      </tr>
<% end %>
</tbody></table></div>
<br>

