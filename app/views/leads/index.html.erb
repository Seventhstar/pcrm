<%= render "sortmenu"%>

<%= hidden_field_tag :sort, params[:sort] %>

<div class="panel panel-default">
<table class="tleads">
  <thead>
    <tr>
      <th><%= sortable "status_id","Статус" %></th>
      <th><%= sortable "status_date","Дата для статуса" %></th>
      <th><%= sortable "fio", "ФИО" %></th>
      <th>Телефон</th>
      
      <th>Информация о запросе</th>
      <th class="center"><%= sortable "footage","Метраж" %></th>
      <th class="center"><%= sortable "start_date","Дата" %></th>
      
      <th class="edit_delete"></th>
    </tr>
  </thead>

  <% cur_month  = nil %>
  <% cur_user   = nil %>
  <% cur_status = nil %>
  <tbody>
    <% @leads.each do |lead| %>

      <% if cur_month != lead.status_date.month && (params[:sort] == "status_date" || params[:sort] == nil)%>
      <% cur_month = lead.status_date.month %>
      <tr class="month"><td colspan="8" class="month"><%= t lead.status_date.strftime("%B") %>  <%= lead.status_date.strftime("%Y") %></td></tr><tr>
      <% elsif cur_user != lead.user.name && (params[:sort] == "user_id")%>
        <% cur_user = lead.user.name %>
        <tr class="month"><td colspan="8" class="month"><%= t lead.user.name %></td></tr><tr>
      <% elsif cur_status != lead.status.name && (params[:sort] == "status_id")%>
        <% cur_status = lead.status.name %>
        <tr class="month"><td colspan="8" class="month"><%= t lead.status.name %></td></tr>
      <% end %>
        <tr class="<%= class_for_lead(lead) %>" >      
        <td><%= lead.status_name %></td>
        <td><%= lead.status_date %></td>
        <td><%= lead.fio %></td>
        <td><%= lead.phone %></td>
        <td><%= lead.info %></td>
        <td class="center"><%= lead.footage %></td>
        <td class="center"><%= lead.start_date %></td>
        <%= render "shared/td_edit_delete", :element => lead %>

      </tr>
    <% end %>
  </tbody>
</table>
</div>
<br>

